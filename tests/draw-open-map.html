<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Canvas Tests</title>
	<script type="text/javascript" src="../src/o2.js"></script>
	<script type="text/javascript" src="../src/Mixin/Data.js"></script>
	<script type="text/javascript" src="../src/Mixin/Events.js"></script>
	<script type="text/javascript" src="../src/Mixin/Prop.js"></script>

	<script type="text/javascript" src="../src/Fairies/Mixin/GridProxy.js"></script>

	<script type="text/javascript" src="../src/Fairies/Grid.js"></script>
	<script type="text/javascript" src="../src/Fairies/Tileset.js"></script>
	<script type="text/javascript" src="../src/Fairies/Animation.js"></script>
	<script type="text/javascript" src="../src/Fairies/Vector.js"></script>
	<script type="text/javascript" src="../src/Fairies/Flight.js"></script>
	<script type="text/javascript" src="../src/Fairies/Shape.js"></script>
	<script type="text/javascript" src="../src/Fairies/Rect.js"></script>
	<script type="text/javascript" src="../src/Fairies/Mobile.js"></script>
	<script type="text/javascript" src="../src/Fairies/Sprite.js"></script>
	<script type="text/javascript" src="../src/Fairies/Sector.js"></script>
	<script type="text/javascript" src="../src/Fairies/Collider.js"></script>
	<script type="text/javascript" src="../src/Fairies/Wing.js"></script>
	<script type="text/javascript" src="../src/Fairies/Wings/Linear.js"></script>
	<script type="text/javascript" src="../src/Fairies/Wings/Gravity.js"></script>
	<script type="text/javascript" src="../src/Fairies/Wings/BumpFloor.js"></script>
	<script type="text/javascript" src="../src/Fairies/Wings/Shock.js"></script>
	<script type="text/javascript" src="../src/Fairies/Wings/Air.js"></script>
	<script type="text/javascript" src="../src/Fairies/Layer.js"></script>
	<script type="text/javascript" src="../src/Fairies/MobileLayer.js"></script>
	<script type="text/javascript" src="../src/Fairies/WorldGrid.js"></script>
	<script type="text/javascript" src="../src/Fairies/View.js"></script>
	
	<script type="text/javascript">


var oCanvas;
var oContext;

var wg, fAngle = 0, vMove = new Fairy.Vector();
var oCVS = {};

function doomloop() {
	fAngle += Math.random() / 100;
	var vx = 4*Math.sin(fAngle);
	var vy = 4*Math.cos(fAngle);
	vMove.set(vx, vy);
	wg.view().flight().move(vMove);
	oContext.fillStyle = '#AAA';
	oContext.fillRect(0, 0, oCanvas.width, oCanvas.height);
	wg.update();
	wg.render(oContext);
}

function main() {
	oCanvas = document.getElementById('canvas');
	oContext = oCanvas.getContext('2d');
	wg = new Fairy.WorldGrid();
	wg
		.zoneWidth(256)
		.zoneHeight(256)
		.view()
		.width(oCanvas.width)
		.height(oCanvas.height)
	wg.on('zone.n', function(oEvent) {
		var cvs, ctx, fColor = 180 * Math.sin(oEvent.x / 3 + oEvent.y / 5) + 180;
		cvs = document.createElement('canvas');
		cvs.width = wg.zoneWidth();
		cvs.height = wg.zoneHeight();
		ctx = cvs.getContext('2d');
		ctx.fillStyle = 'hsl(' + fColor + ', 50%, 50%)';
		ctx.strokeStyle = 'black';
		ctx.fillRect(0, 0, cvs.width, cvs.height);
		ctx.strokeRect(4, 4, cvs.width - 8, cvs.height - 8);
		ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
		ctx.fillText(oEvent.x.toString() + ' : ' + oEvent.y.toString(), 16, 32);
		oEvent.canvas = cvs;
	});
	setInterval(doomloop, 32);

}

window.addEventListener('load', main);

	</script>
</head>
<body>
	<canvas id="canvas" width="800" height="600"></canvas>
</body>
</html>
